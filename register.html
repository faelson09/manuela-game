<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registrar | Quiz</title>
    <style>
      @keyframes moveBg {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      body {
        font-family: Arial, Helvetica, sans-serif;
        margin: 0;
        padding: 24px 16px;
        background: linear-gradient(120deg, #0ea5e9, #ffffff, #ec4899);
        background-size: 200% 200%;
        animation: moveBg 18s ease infinite;
        color: #1e293b;
        min-height: 100vh;
      }
      .container {
        max-width: 420px;
        margin: 60px auto;
        background: rgba(255, 255, 255, 0.9);
        padding: 24px;
        border-radius: 16px;
        box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.25),
          0 0 22px rgba(236, 72, 153, 0.25);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 16px;
        font-size: 22px;
        text-align: center;
      }
      form {
        display: grid;
        gap: 12px;
      }
      label {
        font-size: 14px;
        color: #64748b;
      }
      input {
        width: 100%;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        background: radial-gradient(
          120% 120% at 10% 10%,
          #ffffff 0%,
          #f8fafc 60%
        );
        color: #1e293b;
      }
      button {
        padding: 12px;
        border-radius: 10px;
        border: 0;
        background: linear-gradient(90deg, #3b82f6, #ec4899);
        color: white;
        cursor: pointer;
        font-weight: 700;
        letter-spacing: 0.3px;
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.25),
          0 0 0 0 rgba(236, 72, 153, 0.25);
        transition: transform 0.12s ease, box-shadow 0.12s ease;
      }
      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 18px rgba(59, 130, 246, 0.25),
          0 8px 22px rgba(236, 72, 153, 0.25);
      }
      .row {
        display: grid;
        gap: 8px;
      }
      .actions {
        display: grid;
        gap: 8px;
        margin-top: 8px;
      }
      .error {
        color: #dc2626;
        background: #fef2f2;
        border: 1px solid #fecaca;
        padding: 8px 10px;
        border-radius: 8px;
        display: none;
      }
      .success {
        color: #16a34a;
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        padding: 8px 10px;
        border-radius: 8px;
        display: none;
      }
      .hint {
        color: #64748b;
        font-size: 12px;
      }
      .link {
        color: #ec4899;
        text-decoration: none;
      }
      .link:hover {
        color: #be185d;
        text-decoration: underline;
      }
    </style>
    <script>
      const API = "https://manuela-game-api.vercel.app";
      function show(el) {
        el.style.display = "block";
      }
      function hide(el) {
        el.style.display = "none";
      }

      async function handleRegister(e) {
        e.preventDefault();
        const nome = document.getElementById("nome").value.trim();
        const senha = document.getElementById("senha").value.trim();
        const errorBox = document.getElementById("error");
        const successBox = document.getElementById("success");
        hide(errorBox);
        hide(successBox);

        if (!nome || !senha) {
          errorBox.textContent = "Informe nome e senha para registrar.";
          show(errorBox);
          return;
        }
        try {
          const res = await fetch(`${API}/usuarios`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nome, senha }),
          });
          if (!res.ok) throw new Error(await res.text());
          const data = await res.json();
          localStorage.setItem("sessionId", data.id);
          localStorage.setItem("sessionName", nome);
          show(successBox);
          successBox.innerHTML = `
            <div style="margin-bottom:8px;">Conta criada com sucesso!</div>
            <div class="hint" style="margin-bottom:8px;">Guarde seu ID (nome único) para futuros logins:</div>
            <div style="display:flex; gap:8px; align-items:center; flex-wrap: wrap; margin-bottom:8px;">
              <code id="generated-id" style="padding:6px 8px; border:1px solid #e2e8f0; border-radius:6px; background:#fff; color:#1e293b;">${
                data.id || ""
              }</code>
              <button id="btn-copy-id" type="button" style="padding:8px 10px; border-radius:8px; border:1px solid #e2e8f0; background:#f8fafc; color:#1e293b; cursor:pointer;">Copiar ID</button>
            </div>
            <button id="btn-continue" type="button">Continuar</button>
          `;
          const idEl = document.getElementById("generated-id");
          const copyBtn = document.getElementById("btn-copy-id");
          const contBtn = document.getElementById("btn-continue");
          if (copyBtn && idEl) {
            copyBtn.addEventListener("click", async () => {
              const text = idEl.textContent || "";
              try {
                await navigator.clipboard.writeText(text);
                copyBtn.textContent = "Copiado!";
                setTimeout(() => (copyBtn.textContent = "Copiar ID"), 1500);
              } catch (_) {
                // Fallback
                const ta = document.createElement("textarea");
                ta.value = text;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand("copy");
                document.body.removeChild(ta);
                copyBtn.textContent = "Copiado!";
                setTimeout(() => (copyBtn.textContent = "Copiar ID"), 1500);
              }
            });
          }
          if (contBtn) {
            contBtn.addEventListener("click", () => {
              window.location.href = "/index.html";
            });
          }
        } catch (err) {
          errorBox.textContent = err.message || "Erro inesperado.";
          show(errorBox);
        }
      }

      window.addEventListener("DOMContentLoaded", () => {
        document
          .getElementById("btn-register")
          .addEventListener("click", handleRegister);
        const sid = localStorage.getItem("sessionId");
        if (sid) {
          window.location.href = "/index.html";
        }
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h1
        style="
          margin: 0;
          font-size: 28px;
          background: linear-gradient(90deg, #3b82f6, #ec4899);
          background-clip: text;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          text-align: center;
        "
      >
        Quiz Bíblico
      </h1>
      <h2
        style="
          margin: 8px 0 16px;
          font-size: 18px;
          text-align: center;
          color: #64748b;
        "
      >
        Criar conta
      </h2>
      <div class="hint">Seu ID de login será gerado automaticamente.</div>
      <div id="error" class="error"></div>
      <div id="success" class="success"></div>
      <form id="auth-form">
        <div class="row">
          <label for="nome">Nome</label>
          <input id="nome" type="text" placeholder="Seu nome" />
        </div>
        <div class="row">
          <label for="senha">Senha</label>
          <input id="senha" type="password" placeholder="Crie uma senha" />
        </div>
        <div class="actions">
          <button id="btn-register" type="button">Criar conta</button>
          <a class="link" href="/login.html">Já tem conta? Entrar</a>
        </div>
      </form>
    </div>
  </body>
</html>
